{% extends "base.html" %}
{% load static %}

{% block title %}{{ playlist.name }} - Music - Roshan Damor{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/playlist_detail.css' %}">
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/playlist_detail.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="playlist-detail-container">
    <div class="playlist-detail-content">
        <!-- Back Button -->
        <div class="back-navigation" data-animation="fade-in-up">
            <a href="{% url 'roshan:my_playlist' %}" class="outline-btn">
                <i class="fa-solid fa-arrow-left"></i> Back to Playlists
            </a>
            <span class="track-count-badge">{{ tracks|length }} tracks</span>
        </div>

        <!-- Playlist Header -->
        <div class="playlist-header" data-animation="fade-in-up">
            <div class="playlist-cover">
                <img src="{{ playlist.image_url }}" alt="{{ playlist.name }} cover" loading="lazy">
                <div class="play-all-overlay" id="play-all-cover-btn">
                    <i class="fa-solid fa-play"></i>
                </div>
            </div>
            <div class="playlist-info">
                <h1>{{ playlist.name }}</h1>
                {% if playlist.description %}
                <p class="playlist-description">{{ playlist.description }}</p>
                {% endif %}
                <div class="playlist-stats">
                    {% if playlist.total_duration %}
                    <span class="total-duration">{{ playlist.total_duration }}</span>
                    {% endif %}
                </div>
                <div class="playlist-actions">
                    <button class="filled-btn" id="play-all-btn">
                        <i class="fa-solid fa-play"></i> Play All
                    </button>
                    <a href="{{ playlist.external_url }}" class="outline-btn" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-spotify"></i> Open in Spotify
                    </a>
                </div>
            </div>
        </div>

        <!-- Track List -->
        <div class="track-list-container card" data-animation="fade-in-up">
            <div class="track-list-header">
                <div class="header-item">#</div>
                <div class="header-item">Title</div>
                <div class="header-item desktop-only">Album</div>
                <div class="header-item desktop-only">Duration</div>
                <div class="header-item">Actions</div>
            </div>
            
            <div class="track-list" id="track-list">
                {% for track in tracks %}
                <div class="track-item" data-track-index="{{ forloop.counter0 }}">
                    <div class="track-number">
                        <span class="number">{{ forloop.counter }}</span>
                        <div class="play-indicator"><i class="fa-solid fa-play"></i></div>
                    </div>
                    <div class="track-details">
                        <div class="title">{{ track.name }}</div>
                        <div class="artist">{{ track.artist }}</div>
                    </div>
                    <div class="track-album desktop-only">{{ track.album|default:"-" }}</div>
                    <div class="track-duration desktop-only">{{ track.duration_formatted }}</div>
                    <div class="track-actions">
                        <button class="action-btn play-track-btn" data-track-index="{{ forloop.counter0 }}" title="Play Track">
                            <i class="fa-solid fa-play"></i>
                        </button>
                        <a href="{{ track.external_url }}" class="action-btn" target="_blank" rel="noopener noreferrer" title="Open in Spotify">
                            <i class="fa-brands fa-spotify"></i>
                        </a>
                    </div>
                </div>
                {% empty %}
                <div class="no-tracks">
                    <i class="fa-solid fa-compact-disc"></i>
                    <p>No tracks available for this playlist.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Music Player -->
<div class="enhanced-music-player hidden" id="music-player">
    <div class="player-main">
        <div class="current-track-info">
            <button id="close-player-btn" class="control-btn close-btn" title="Close Player">
                <i class="fa-solid fa-times"></i>
            </button>
            <div class="track-cover"><img id="current-track-cover" src="{{ playlist.image_url }}" alt="Track cover"></div>
            <div class="track-meta">
                <div class="track-name" id="current-track-name">Select a track</div>
                <div class="track-artist" id="current-track-artist">No artist</div>
            </div>
        </div>

        <div class="player-controls-section">
            <div class="player-controls">
                <!-- Left side controls -->
                <div class="left-controls">
                    <button id="loop-shuffle-btn" class="control-btn" title="Loop Mode" data-mode="off">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </button>
                    <button id="prev-btn" class="control-btn" title="Previous">
                        <i class="fa-solid fa-step-backward"></i>
                    </button>
                </div>
                
                <!-- Center control -->
                <div class="center-controls">
                    <button id="play-pause-btn" class="control-btn play-btn" title="Play/Pause">
                        <i class="fa-solid fa-play"></i>
                    </button>
                </div>
                
                <!-- Right side controls -->
                <div class="right-controls">
                    <button id="next-btn" class="control-btn" title="Next">
                        <i class="fa-solid fa-step-forward"></i>
                    </button>
                    <button id="mute-btn" class="control-btn" title="Mute/Unmute">
                        <i class="fa-solid fa-volume-high"></i>
                    </button>
                </div>
            </div>
            <div class="progress-section">
                <span class="time" id="current-time">0:00</span>
                <div class="progress-bar" id="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
                <span class="time" id="duration-time">0:00</span>
            </div>
        </div>
    </div>
    <audio id="audio-player" preload="none"></audio>
</div>

<!-- Pass data to JavaScript -->
<script>
    window.playlistData = {
        id: '{{ playlist.id }}',
        name: '{{ playlist.name }}',
        tracks: {{ tracks_json|safe }},
        coverUrl: '{{ playlist.image_url }}'
    };
</script>
{% endblock %}