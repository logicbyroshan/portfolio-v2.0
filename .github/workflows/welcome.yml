name: ğŸ¤ Welcome New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]
  workflow_dispatch:

jobs:
  # ======================= WELCOME NEW ISSUE CREATORS =======================
  welcome-issue:
    name: ğŸ‰ Welcome New Issue Creator
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    
    steps:
    - name: ğŸ¤ Welcome First Time Issue Creator
      uses: actions/github-script@v7
      with:
        script: |
          const creator = context.payload.issue.user.login;
          
          // Check if this is the user's first issue
          const { data: issues } = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            creator: creator,
            state: 'all'
          });
          
          const isFirstIssue = issues.length <= 1;
          
          if (isFirstIssue) {
            const welcomeMessage = `
          ğŸ‰ **Welcome to Portfolio v2.0!** 
          
          Thank you @${creator} for opening your first issue! We're excited to have you as part of our community.
          
          ## ğŸ“‹ What happens next?
          - Our maintainers will review your issue soon
          - Feel free to provide additional details if needed
          - Check out our [Contributing Guidelines](README.md) for more info
          
          ## ğŸš€ Want to contribute?
          - Look for issues labeled \`good first issue\` or \`help wanted\`
          - Fork the repo and make your changes
          - Submit a pull request when ready!
          
          ## ğŸƒ Hacktoberfest
          If it's October, your contributions may count towards Hacktoberfest! 
          
          Thanks for helping make this project better! ğŸ™
          `;
          
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: welcomeMessage
            });
          }

  # ======================= WELCOME NEW PR CONTRIBUTORS =======================
  welcome-pr:
    name: ğŸš€ Welcome New PR Contributor
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target'
    
    steps:
    - name: ğŸ¤ Welcome First Time Contributor
      uses: actions/github-script@v7
      with:
        script: |
          const contributor = context.payload.pull_request.user.login;
          
          // Check if this is the user's first PR
          const { data: prs } = await github.rest.pulls.list({
            owner: context.repo.owner,
            repo: context.repo.repo,
            state: 'all'
          });
          
          const userPRs = prs.filter(pr => pr.user.login === contributor);
          const isFirstPR = userPRs.length <= 1;
          
          if (isFirstPR) {
            const welcomeMessage = `
          ğŸ‰ **Welcome and thank you for your first contribution!** 
          
          Hello @${contributor}! Thank you for submitting your first pull request to Portfolio v2.0! ğŸš€
          
          ## ğŸ” Review Process
          - Our CI checks will run automatically
          - A maintainer will review your changes soon
          - We may request some changes or ask questions
          
          ## âœ… Make sure your PR:
          - [ ] Follows our coding standards
          - [ ] Includes tests if applicable  
          - [ ] Updates documentation if needed
          - [ ] Has a clear description of changes
          
          ## ğŸ¯ CI Checks
          Your PR will be tested for:
          - âœ… Python lint checks
          - âœ… Django tests
          - âœ… Frontend validation
          - âœ… Security scanning
          - âœ… CodeQL analysis
          
          ## ğŸƒ Hacktoberfest
          If it's October, this contribution counts towards Hacktoberfest! 
          
          We appreciate your contribution and look forward to working with you! ğŸ™
          `;
          
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: welcomeMessage
            });
          }

  # ======================= PR READY FOR REVIEW =======================
  pr-ready-review:
    name: ğŸ“ PR Ready for Review
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target'
    
    steps:
    - name: ğŸ“ Check if PR is Ready
      uses: actions/github-script@v7
      with:
        script: |
          const pr = context.payload.pull_request;
          
          // Check if PR is not draft and has description
          if (!pr.draft && pr.body && pr.body.length > 20) {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              labels: ['ready for review']
            });
            
            console.log('ğŸ·ï¸ Added "ready for review" label');
          } else if (pr.draft) {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              labels: ['work in progress']
            });
            
            console.log('ğŸ·ï¸ Added "work in progress" label');
          }